var _shared={pullStartY:null,pullMoveY:null,handlers:[],styleEl:null,events:null,dist:0,state:"pending",timeout:null,distResisted:0,supportsPassive:!1,supportsPointerEvents:"undefined"!=typeof window&&!!window.PointerEvent};try{window.addEventListener("test",null,{get passive(){_shared.supportsPassive=!0}})}catch(e){}function setupDOM(e){if(!e.ptrElement){var t=document.createElement("div");e.mainElement!==document.body?e.mainElement.parentNode.insertBefore(t,e.mainElement):document.body.insertBefore(t,document.body.firstChild),t.classList.add(e.classPrefix+"ptr"),t.innerHTML=e.getMarkup().replace(/__PREFIX__/g,e.classPrefix),e.ptrElement=t,"function"==typeof e.onInit&&e.onInit(e),_shared.styleEl||(_shared.styleEl=document.createElement("style"),_shared.styleEl.setAttribute("id","pull-to-refresh-js-style"),document.head.appendChild(_shared.styleEl)),_shared.styleEl.textContent=e.getStyles().replace(/__PREFIX__/g,e.classPrefix).replace(/\s+/g," ")}return e}function onReset(e){e.ptrElement&&(e.ptrElement.classList.remove(e.classPrefix+"refresh"),e.ptrElement.style[e.cssProp]="0px",setTimeout((function(){e.ptrElement&&e.ptrElement.parentNode&&(e.ptrElement.parentNode.removeChild(e.ptrElement),e.ptrElement=null),_shared.state="pending"}),e.refreshTimeout))}function update(e){var t=e.ptrElement.querySelector("."+e.classPrefix+"icon"),n=e.ptrElement.querySelector("."+e.classPrefix+"text");t&&("refreshing"===_shared.state?t.innerHTML=e.iconRefreshing:t.innerHTML=e.iconArrow),n&&("releasing"===_shared.state&&(n.innerHTML=e.instructionsReleaseToRefresh),"pulling"!==_shared.state&&"pending"!==_shared.state||(n.innerHTML=e.instructionsPullToRefresh),"refreshing"===_shared.state&&(n.innerHTML=e.instructionsRefreshing))}var _timeout,_ptr={setupDOM,onReset,update},screenY=function(e){return _shared.pointerEventsEnabled&&_shared.supportsPointerEvents?e.screenY:e.touches[0].screenY},_setupEvents=function(){var e;function t(t){var n=_shared.handlers.filter((function(e){return e.contains(t.target)}))[0];_shared.enable=!!n,n&&"pending"===_shared.state&&(e=_ptr.setupDOM(n),n.shouldPullToRefresh()&&(_shared.pullStartY=screenY(t)),clearTimeout(_shared.timeout),_ptr.update(n))}function n(t){e&&e.ptrElement&&_shared.enable&&(_shared.pullStartY?_shared.pullMoveY=screenY(t):e.shouldPullToRefresh()&&(_shared.pullStartY=screenY(t)),"refreshing"!==_shared.state?("pending"===_shared.state&&(e.ptrElement.classList.add(e.classPrefix+"pull"),_shared.state="pulling",_ptr.update(e)),_shared.pullStartY&&_shared.pullMoveY&&(_shared.dist=_shared.pullMoveY-_shared.pullStartY),_shared.distExtra=_shared.dist-e.distIgnore,_shared.distExtra>0&&(t.cancelable&&t.preventDefault(),e.ptrElement.style[e.cssProp]=_shared.distResisted+"px",_shared.distResisted=e.resistanceFunction(_shared.distExtra/e.distThreshold)*Math.min(e.distMax,_shared.distExtra),"pulling"===_shared.state&&_shared.distResisted>e.distThreshold&&(e.ptrElement.classList.add(e.classPrefix+"release"),_shared.state="releasing",_ptr.update(e)),"releasing"===_shared.state&&_shared.distResisted<e.distThreshold&&(e.ptrElement.classList.remove(e.classPrefix+"release"),_shared.state="pulling",_ptr.update(e)))):t.cancelable&&e.shouldPullToRefresh()&&_shared.pullStartY<_shared.pullMoveY&&t.preventDefault())}function s(){if(e&&e.ptrElement&&_shared.enable){if(clearTimeout(_timeout),_timeout=setTimeout((function(){e&&e.ptrElement&&"pending"===_shared.state&&_ptr.onReset(e)}),500),"releasing"===_shared.state&&_shared.distResisted>e.distThreshold)_shared.state="refreshing",e.ptrElement.style[e.cssProp]=e.distReload+"px",e.ptrElement.classList.add(e.classPrefix+"refresh"),_shared.timeout=setTimeout((function(){var t=e.onRefresh((function(){return _ptr.onReset(e)}));t&&"function"==typeof t.then&&t.then((function(){return _ptr.onReset(e)})),t||e.onRefresh.length||_ptr.onReset(e)}),e.refreshTimeout);else{if("refreshing"===_shared.state)return;e.ptrElement.style[e.cssProp]="0px",_shared.state="pending"}_ptr.update(e),e.ptrElement.classList.remove(e.classPrefix+"release"),e.ptrElement.classList.remove(e.classPrefix+"pull"),_shared.pullStartY=_shared.pullMoveY=null,_shared.dist=_shared.distResisted=0}}function r(){e&&e.mainElement.classList.toggle(e.classPrefix+"top",e.shouldPullToRefresh())}var i=_shared.supportsPassive?{passive:_shared.passive||!1}:void 0;return _shared.pointerEventsEnabled&&_shared.supportsPointerEvents?(window.addEventListener("pointerup",s),window.addEventListener("pointerdown",t),window.addEventListener("pointermove",n,i)):(window.addEventListener("touchend",s),window.addEventListener("touchstart",t),window.addEventListener("touchmove",n,i)),window.addEventListener("scroll",r),{onTouchEnd:s,onTouchStart:t,onTouchMove:n,onScroll:r,destroy:function(){_shared.pointerEventsEnabled&&_shared.supportsPointerEvents?(window.removeEventListener("pointerdown",t),window.removeEventListener("pointerup",s),window.removeEventListener("pointermove",n,i)):(window.removeEventListener("touchstart",t),window.removeEventListener("touchend",s),window.removeEventListener("touchmove",n,i)),window.removeEventListener("scroll",r)}}},_ptrMarkup='\n<div class="__PREFIX__box">\n  <div class="__PREFIX__content">\n    <div class="__PREFIX__icon"></div>\n    <div class="__PREFIX__text"></div>\n  </div>\n</div>\n',_ptrStyles="\n.__PREFIX__ptr {\n  box-shadow: inset 0 -3px 5px rgba(0, 0, 0, 0.12);\n  pointer-events: none;\n  font-size: 0.85em;\n  font-weight: bold;\n  top: 0;\n  height: 0;\n  transition: height 0.3s, min-height 0.3s;\n  text-align: center;\n  width: 100%;\n  overflow: hidden;\n  display: flex;\n  align-items: flex-end;\n  align-content: stretch;\n}\n\n.__PREFIX__box {\n  padding: 10px;\n  flex-basis: 100%;\n}\n\n.__PREFIX__pull {\n  transition: none;\n}\n\n.__PREFIX__text {\n  margin-top: .33em;\n  color: rgba(0, 0, 0, 0.3);\n}\n\n.__PREFIX__icon {\n  color: rgba(0, 0, 0, 0.3);\n  transition: transform .3s;\n}\n\n/*\nWhen at the top of the page, disable vertical overscroll so passive touch\nlisteners can take over.\n*/\n.__PREFIX__top {\n  touch-action: pan-x pan-down pinch-zoom;\n}\n\n.__PREFIX__release .__PREFIX__icon {\n  transform: rotate(180deg);\n}\n",_defaults={distThreshold:60,distMax:80,distReload:50,distIgnore:0,mainElement:"body",triggerElement:"body",ptrElement:".ptr",classPrefix:"ptr--",cssProp:"min-height",iconArrow:"&#8675;",iconRefreshing:"&hellip;",instructionsPullToRefresh:"Pull down to refresh",instructionsReleaseToRefresh:"Release to refresh",instructionsRefreshing:"Refreshing",refreshTimeout:500,getMarkup:function(){return _ptrMarkup},getStyles:function(){return _ptrStyles},onInit:function(){},onRefresh:function(){return location.reload()},resistanceFunction:function(e){return Math.min(1,e/2.5)},shouldPullToRefresh:function(){return!window.scrollY}},_methods=["mainElement","ptrElement","triggerElement"],_setupHandler=function(e){var t={};return Object.keys(_defaults).forEach((function(n){t[n]=e[n]||_defaults[n]})),t.refreshTimeout="number"==typeof e.refreshTimeout?e.refreshTimeout:_defaults.refreshTimeout,_methods.forEach((function(e){"string"==typeof t[e]&&(t[e]=document.querySelector(t[e]))})),_shared.events||(_shared.events=_setupEvents()),t.contains=function(e){return t.triggerElement.contains(e)},t.destroy=function(){clearTimeout(_shared.timeout);var e=_shared.handlers.indexOf(t);_shared.handlers.splice(e,1)},t},index={setPassiveMode:function(e){_shared.passive=e},setPointerEventsMode:function(e){_shared.pointerEventsEnabled=e},destroyAll:function(){_shared.events&&(_shared.events.destroy(),_shared.events=null),_shared.handlers.forEach((function(e){e.destroy()}))},init:function(e){void 0===e&&(e={});var t=_setupHandler(e);return _shared.handlers.push(t),t},_:{setupHandler:_setupHandler,setupEvents:_setupEvents,setupDOM:_ptr.setupDOM,onReset:_ptr.onReset,update:_ptr.update}};export default index;
